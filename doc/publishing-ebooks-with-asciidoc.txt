Publishing eBooks with AsciiDoc
===============================

// Use the same article for both a blog post and on the AsciiDoc
// website.
:blogpost-title: Publishing eBooks with AsciiDoc
:blogpost-status: published
:blogpost-doctype: article
:blogpost-posttype: post
:blogpost-categories: AsciiDoc,eBook,EPUB,DocBook

{backend-wordpress}*Published*: 2010-08-10

It's easy to write and publish books in
http://en.wikipedia.org/wiki/EPUB[EPUB] and PDF formats using
http://www.methods.co.nz/asciidoc/[AsciiDoc]. Here are three examples:
The first is a minimal example introducing the AsciiDoc format, the
second ('The Brothers Karamazov') is a rather long multi-part book and
the third ('The Adventures of Sherlock Holmes') includes a front cover
image and fully customized styling.

// Wordpress processing instruction.
pass::[<!--more-->]


== Minimal Book
This didactic example contains a title and two chapters.  The AsciiDoc
source is a plain text file named `minimal-book.txt`:

---------------------------------------------------------------------
= The Book Title

== The first chapter
Nec vitae mus fringilla eu vel pede sed pellentesque. Nascetur fugiat
nobis. Eu felis id mauris sollicitudin ut. Sem volutpat feugiat.
Ornare convallis urna vitae.

Nec mauris sed aliquam nam mauris dolor lorem imperdiet.

== The second chapter
Ut suspendisse nulla. Auctor felis facilisis. Rutrum vivamus nec
lectus porttitor dui dapibus eu ridiculus tempor sodales et. Sit a
cras. Id tellus cubilia erat.

Quisque nullam et. Blandit dui tempor. Posuere in elit diam egestas
sem vivamus vel ac.
---------------------------------------------------------------------

To generate the EPUB formatted book file `minimal-book.epub` run
AsciiDoc's 'a2x' toolchain wrapper command from the command-line:

  a2x -fepub -dbook minimal-book.txt

The `-f` option specifies the output format, the `-d` option specifies
the document type (book, article or manpage).  The optional
`--epubcheck` option tells 'a2x' to validate the EPUB file using
http://code.google.com/p/epubcheck/[epubcheck]. To generate a PDF
version (`minimal-book.pdf`) with 'dblatex' run:

  a2x -fpdf -dbook minimal-book.txt

The example PDFs referenced on this page were built using FOP -- if
you prefer http://xmlgraphics.apache.org/fop/[FOP] over
http://dblatex.sourceforge.net/[dblatex] use:

  a2x -fpdf -dbook --fop minimal-book.txt

NOTE: A number of 'asciidoc' and 'a2x' features used in this article
require AsciiDoc version 8.6.1 -- install version 8.6.1 or better to
compile the examples. The version of
http://wiki.docbook.org/topic/DocBookXslStylesheets[DocBook XSL
Stylesheets] used was 1.75.2.


The Brothers Karamazov
----------------------
'The Brothers Karamazov' is an example of a multi-part book. To
generate the AsciiDoc source I downloaded the
http://www.gutenberg.org[Project Gutenberg] plain text source and
edited it manually (this took around 15 minutes). To generate the
`brothers-karamazov.epub` EPUB file run this command:

  a2x brothers-karamazov.txt

:examples-url: http://www.methods.co.nz/misc/examples/books/

[frame="topbot",options="header",caption=""]
.Brothers Karamazov source files and eBooks
|====================================================================
|EPUB |PDF |AsciiDoc source |Project Gutenburg text
|{examples-url}brothers-karamazov.epub[brothers-karamazov.epub]

|{examples-url}brothers-karamazov.pdf[brothers-karamazov.pdf]

|{examples-url}brothers-karamazov.zip[brothers-karamazov.zip]

|http://www.gutenberg.org/etext/28054

|====================================================================

Here's the start of the AsciiDoc source file showing the AsciiDoc
specific meta-data:

---------------------------------------------------------------------
//
// Text from Project Gutenburg http://www.gutenberg.org/etext/28054
//
// Formatted for AsciiDoc by Stuart Rackham.
//
// a2x default options.
//    a2x: -f epub -d book --epubcheck
// Suppress revision history in dblatex outputs.
//    a2x: --dblatex-opts "-P latex.output.revhistory=0"
// Suppress book part, chapter and section numbering in DocBook XSL outputs.
//    a2x: --xsltproc-opts
//    a2x: "--stringparam part.autolabel 0
//    a2x: --stringparam chapter.autolabel 0
//    a2x: --stringparam section.autolabel.max.depth 0"
//

= The Brothers Karamazov
:author: Fyodor Dostoyevsky
:encoding: iso-8859-1
:plaintext:

..........................................................................
Translated from the Russian of Fyodor Dostoyevsky by Constance Garnett
The Lowell Press New York

 :
 :

***START OF THE PROJECT GUTENBERG EBOOK THE BROTHERS KARAMAZOV***
..........................................................................


= PART I

== The History Of A Family

=== Fyodor Pavlovitch Karamazov

Alexey Fyodorovitch Karamazov was the third son of Fyodor Pavlovitch
...
---------------------------------------------------------------------

- The book, book part and chapter titles have been edited to conform
  to http://www.methods.co.nz/asciidoc/userguide.html#X17[AsciiDoc
  title conventions].

- Book part titles must be level zero titles:

  = Book title (level 0)
  = Part one title (level 0)
  == Chapter 1 title (level 1)
    :

- Sub-chapter levels can be accommodated with `===`, `====` and
  `=====` title prefixes.

- In this example the 'Project Gutenberg' front matter was put in the
  untitled preface inside an AsciiDoc literal block.

- The comment lines starting with `// a2x:` contain 'a2x' command
  options for this document (it's easier to put them in the document
  once than type them every time on the command-line).

- A number of 'xsltproc' options are passed to 'a2x' to suppress book
  part, chapter and section numbering.

- Setting the AsciiDoc 'plaintext' attribute suppresses most of
  http://www.methods.co.nz/asciidoc/userguide.html#_text_formatting[AsciiDoc's
  text formatting] and substitution conventions, this allows large
  amounts of text to be imported with little or no manual editing.

  * Once you have defined the AsciiDoc 'plaintext' attribute the only
    requisite manual editing will be to format the titles and rectify
    the odd paragraph being interpreted as some other AsciiDoc block
    element.
  * In the combined 49 thousand lines of imported 'Sherlock Holmes'
    and 'Brothers Karamazov' text I only encountered two
    misinterpreted list items, neither affected the rendered output or
    necessitated editing.
  * You can selectively enable and disable the 'plaintext' attribute
    throughout your document using AsciiDoc
    http://www.methods.co.nz/asciidoc/userguide.html#X18[attribute
    entries].


The Adventures of Sherlock Holmes
---------------------------------
This book includes a front cover image and a customized page design.
To generate the `adventures-of-sherlock-holmes.epub` EPUB file run
this command:

  a2x adventures-of-sherlock-holmes.txt

Here's a screenshot of the first page of the fist chapter (rendered by
the https://addons.mozilla.org/en-US/firefox/addon/45281/[Firefox
PUBReader addon]):

image::images/epub.png[]

[frame="topbot",options="header",caption=""]
.Sherlock Holmes source files and eBooks
|====================================================================
|EPUB |PDF |AsciiDoc source |Project Gutenburg text
|{examples-url}adventures-of-sherlock-holmes.epub[adventures-of-sherlock-holmes.epub]

|{examples-url}adventures-of-sherlock-holmes.pdf[adventures-of-sherlock-holmes.pdf]

|{examples-url}adventures-of-sherlock-holmes.zip[adventures-of-sherlock-holmes.zip]

|http://www.gutenberg.org/etext/1661

|====================================================================

The {examples-url}adventures-of-sherlock-holmes.zip[AsciiDoc source
Zip file] contains the following files:

`adventures-of-sherlock-holmes.txt`::
  The AsciiDoc source (derived from the
  http://www.gutenberg.org/etext/1661[Project Gutenberg plain text
  source]).

`adventures-of-sherlock-holmes.jpg`::
  The front cover image.

`adventures-of-sherlock-holmes-docinfo.xml`::
  A http://www.methods.co.nz/asciidoc/userguide.html#X87[docinfo] file
  containing DocBook markup for the front cover image and Project
  Gutenberg frontmatter.  DocBook XSL Stylesheets identifies the book
  cover image by the `role="cover"` attribute in the DocBook
  `mediaobject` element.

`adventures-of-sherlock-holmes.css`::
  CSS rules for styling the page layout. The design is based on the
  http://epubzengarden.com[ePub Zen Garden] 'Gbs' style.

`underline.png`::
  A title underline image that is used by the CSS stylesheet.

Here's the start of the AsciiDoc source file showing the AsciiDoc
specific meta-data:

---------------------------------------------------------------------
//
// Text from Project Gutenburg http://www.gutenberg.org/etext/1661
//
// Formatted for AsciiDoc by Stuart Rackham.
//
// a2x default options.
//    a2x: -f epub -d book -a docinfo --epubcheck
//    a2x: --stylesheet adventures-of-sherlock-holmes.css
// Suppress revision history in dblatex outputs.
//    a2x: --dblatex-opts "-P latex.output.revhistory=0"
// Suppress book part, chapter and section numbering in DocBook XSL outputs.
//    a2x: --xsltproc-opts
//    a2x: "--stringparam part.autolabel 0
//    a2x: --stringparam chapter.autolabel 0
//    a2x: --stringparam section.autolabel.max.depth 0"
// Added external resources.
//    a2x: --resource underline.png
//

= The Adventures of Sherlock Holmes
:author: Sir Arthur Conan Doyle
:encoding: iso-8859-1
:plaintext:

== A Scandal in Bohemia

To Sherlock Holmes she is always THE woman. I have seldom heard
...
---------------------------------------------------------------------

The manual editing of imported plain text involves formatting the
title and chapter names as
http://www.methods.co.nz/asciidoc/userguide.html#X17[AsciiDoc titles]
(in this example we've used the 'single line' title format). Sherlock
Holmes only has two title levels:

---------------------------------------------------------------------
= The Adventures of Sherlock Holmes
== A Scandal in Bohemia
== The Red-Headed League
== A Case of Identity
== The Boscombe Valley Mystery
== The Five Orange Pips
== The Man with the Twisted Lip
== The Adventure of the Blue Carbuncle
== The Adventure of the Speckled Band
== The Adventure of the Engineer's Thumb
== The Adventure of the Noble Bachelor
== The Adventure of the Beryl Coronet
== The Adventure of the Copper Beeches
== Colophon
---------------------------------------------------------------------


Styling your books
------------------
You can customize the appearance of a document by creating your own
CSS file. Either create your own or copy and edit the existing default
`docbook-xsl.css` file (located in the AsciiDoc `stylesheets`
configuration directory) to the same directory as your AsciiDoc source
file. Use the 'a2x' `--stylesheet` option if you prefer to use a
different stylesheet file name.

There are some great examples of EPUB book styles at
http://epubzengarden.com/[ePub Zen Garden].


Reading EPUB documents
----------------------
My current favorite software epub reader is the
https://addons.mozilla.org/en-US/firefox/addon/45281/[Firefox
PUBReader addon].  Browsers are a natural fit for EPUB (EPUB is just a
bunch of zipped XHTML files) -- I'd like to see browsers support EPUB
natively.

As of writing this article most eBook readers (with the notable
exception of Amazon's Kindle) support the EPUB format.


