Publishing eBooks with AsciiDoc
===============================

// Use the same article for both a blog post and on the AsciiDoc
// website.
:blogpost-title: Publishing eBooks with AsciiDoc
:blogpost-status: published
:blogpost-doctype: article
:blogpost-posttype: post
:blogpost-categories: AsciiDoc,eBook,EPUB,DocBook

{backend-wordpress}*Published*: 2010-08-10

It's easy to write and publish books in
http://en.wikipedia.org/wiki/EPUB[EPUB] and PDF formats using
http://www.methods.co.nz/asciidoc/[AsciiDoc]. Here are three examples:
The first is a minimal example introducing the AsciiDoc format, the
second and third are real books totalling over 49 thousand lines of
text.

// Wordpress processing instruction.
pass::[<!--more-->]


== Minimal Book
This didactic example contains a title and two chapters.  The AsciiDoc
source is a plain text file named `minimal-book.txt`:

---------------------------------------------------------------------
= The Book Title

== The first chapter
Nec vitae mus fringilla eu vel pede sed pellentesque. Nascetur fugiat
nobis. Eu felis id mauris sollicitudin ut. Sem volutpat feugiat.
Ornare convallis urna vitae.

Nec mauris sed aliquam nam mauris dolor lorem imperdiet.

== The second chapter
Ut suspendisse nulla. Auctor felis facilisis. Rutrum vivamus nec
lectus porttitor dui dapibus eu ridiculus tempor sodales et. Sit a
cras. Id tellus cubilia erat.

Quisque nullam et. Blandit dui tempor. Posuere in elit diam egestas
sem vivamus vel ac.
---------------------------------------------------------------------

To generate the EPUB formatted book file `minimal-book.epub` run
AsciiDoc's 'a2x' toolchain wrapper command from the command-line:

  a2x -fepub -dbook minimal-book.txt

The `-f` option specifies the output format, the `-d` option specifies
the document type (book, article or manpage).  The optional
`--epubcheck` option tells 'a2x' to validate the EPUB file using
http://code.google.com/p/epubcheck/[epubcheck]. To generate a PDF
version (`minimal-book.pdf`) run:

  a2x -fpdf -dbook minimal-book.txt

If you prefer http://xmlgraphics.apache.org/fop/[FOP] over
http://dblatex.sourceforge.net/[dblatex] use:

  a2x -fpdf -dbook --fop minimal-book.txt

NOTE: A number of 'asciidoc' and 'a2x' features used in this article
were introduced in AsciiDoc version 8.6.0 -- install version 8.6.0 or
better to compile the examples. The version of
http://wiki.docbook.org/topic/DocBookXslStylesheets[DocBook XSL
Stylesheets] used was 1.75.2.


== The Adventures of Sherlock Holmes
Now for a more substantial example. To generate the AsciiDoc source I
downloaded the http://www.gutenberg.org[Project Gutenberg] plain text
source and edited it manually (this took around 20 minutes).

:examples-url: http://www.methods.co.nz/misc/examples/books/

[frame="topbot",options="header"]
|====================================================================
|EPUB |PDF |AsciiDoc source |Project Gutenburg text
|{examples-url}adventures-of-sherlock-holmes.epub[adventures-of-sherlock-holmes.epub]

|{examples-url}adventures-of-sherlock-holmes.pdf[adventures-of-sherlock-holmes.pdf]

|{examples-url}adventures-of-sherlock-holmes.zip[adventures-of-sherlock-holmes.zip]

|http://www.gutenberg.org/etext/1661

|====================================================================

Here's the start of the AsciiDoc source file showing the AsciiDoc
specific meta-data:

---------------------------------------------------------------------
//
// Text from Project Gutenburg http://www.gutenberg.org/etext/1661
//
// Formatted for AsciiDoc by Stuart Rackham.
//
// a2x default options.
//    a2x: -f epub -d book -a docinfo --epubcheck
// Suppress revision history in dblatex outputs.
//    a2x: --dblatex-opts "-P latex.output.revhistory=0"
//

= The Adventures of Sherlock Holmes
:author: Sir Arthur Conan Doyle
:encoding: iso-8859-1
:plaintext:

== A Scandal in Bohemia

To Sherlock Holmes she is always THE woman. I have seldom heard ...
---------------------------------------------------------------------

To generate the `adventures-of-sherlock-holmes.epub` EPUB file run
this command:

  a2x adventures-of-sherlock-holmes.txt

Points to note:

- The comment lines starting with `// a2x:` contain 'a2x' command
  options for this document (it's easier to put them in the document
  once than type them every time on the command-line).
- Setting the AsciiDoc 'plaintext' attribute suppresses most of
  AsciiDoc's text formatting and substitution conventions, this allows
  large amounts of text to be imported with little or no manual
  editing.

The EPUB file includes a book cover image and the Project Gutenberg
legal notice, both of these items have been added by 'asciidoc' from
the `adventures-of-sherlock-holmes-docinfo.xml` 'docinfo' file (a file
containing DocBook elements for inclusion in the DocBook 'bookinfo'
element).  DocBook XSL Stylesheets identifies the book cover image in
the docinfo file by the `role="cover"` attribute on the `mediaobject`
element.

The manual editing of imported plain text involves formatting the
title and chapter names as
http://www.methods.co.nz/asciidoc/userguide.html#X17[AsciiDoc titles].
In the examples I've used the 'single line' title format.  Sherlock
Holmes only has two title levels:

---------------------------------------------------------------------
= The Adventures of Sherlock Holmes
== A Scandal in Bohemia
== The Red-Headed League
== A Case of Identity
== The Boscombe Valley Mystery
== The Five Orange Pips
== The Man with the Twisted Lip
== The Adventure of the Blue Carbuncle
== The Adventure of the Speckled Band
== The Adventure of the Engineer's Thumb
== The Adventure of the Noble Bachelor
== The Adventure of the Beryl Coronet
== The Adventure of the Copper Beeches
== Colophon
---------------------------------------------------------------------

So long as you have defined the AsciiDoc 'plaintext' attribute the
only remaining manual editing will be the odd paragraph being
interpreted as some other AsciiDoc block element. In the combined 49
thousand lines of imported 'Sherlock Holmes' and 'Brothers Karamazov'
text I only encountered two misinterpreted list items, neither
affected the rendered output or necessitated editing.

NOTE: If you are writing a document from scratch you'll probably want
to take advantage of
http://www.methods.co.nz/asciidoc/userguide.html#_text_formatting[AsciiDoc's
rich text formatting conventions], in which case do not define the
AsciiDoc 'plaintext' attribute.


== The Brothers Karamazov
'The Brothers Karamazov' is an example of a multi-part book.

[frame="topbot",options="header"]
|====================================================================
|EPUB |PDF |AsciiDoc source |Project Gutenburg text
|{examples-url}brothers-karamazov.epub[brothers-karamazov.epub]

|{examples-url}brothers-karamazov.pdf[brothers-karamazov.pdf]

|{examples-url}brothers-karamazov.zip[brothers-karamazov.zip],

|http://www.gutenberg.org/etext/28054

|====================================================================

Here's the start of the AsciiDoc source file showing the AsciiDoc
specific meta-data:

---------------------------------------------------------------------
//
// Text from Project Gutenburg http://www.gutenberg.org/etext/28054
//
// Formatted for AsciiDoc by Stuart Rackham.
//
// a2x default options.
//    a2x: -fepub -dbook --epubcheck
// Suppress revision history in dblatex outputs.
//    a2x: --dblatex-opts "-P latex.output.revhistory=0"
// Suppress part and chapter numbering in DocBook XSL outputs.
//    a2x: --xsltproc-opts
//    a2x: "--stringparam section.autolabel.max.depth 0
//    a2x: --stringparam chapter.autolabel 0
//    a2x: --stringparam part.autolabel 0"
//

= The Brothers Karamazov
:author: Fyodor Dostoyevsky
:encoding: iso-8859-1
:plaintext:

..........................................................................
Translated from the Russian of Fyodor Dostoyevsky by Constance Garnett
The Lowell Press New York

 :
 :

***START OF THE PROJECT GUTENBERG EBOOK THE BROTHERS KARAMAZOV***
..........................................................................


= PART I

== The History Of A Family

=== Fyodor Pavlovitch Karamazov

Alexey Fyodorovitch Karamazov was the third son of Fyodor Pavlovitch
...
---------------------------------------------------------------------

To generate the `brothers-karamazov.epub` EPUB file run this command:

  a2x brothers-karamazov.txt

There are a number of differences between this and the Sherlock Holmes
meta-data:

- I haven't used a 'docinfo' file and there is no cover image -- the
  book is built from a single `brothers-karamazov.txt` text file.
- In this example the 'Project Gutenberg' heading was put in the
  untitled preface using an AsciiDoc literal block.
- A number of 'xsltproc' options are passed to 'a2x' to suppress part
  and chapter numbering.

The part titles of multi-part books like must be level zero titles:

---------------------------------------------------------------------
= Book title (level 0)
= Part one title (level 0)
== Chapter 1 title (level 1)
  :
---------------------------------------------------------------------

Additional sub-chapter levels can be accommodated with `===`, `====`
and `=====` title prefixes.


== Styling your books
To date most EPUB documents have enjoyed a reputation for, to put it
kindly, utilitarian styling (the above examples included).

You can completely customize the appearance of a document by creating
your own CSS file. The easiest way to do this is to copy the existing
default `docbook-xsl.css` file (located in the AsciiDoc `stylesheets`
configuration directory) to the same directory as your AsciiDoc source
file and then edit it.

There are some great examples of EPUB book styles at
http://epubzengarden.com/[ePub Zen Garden].


== Reading EPUB documents
My current favorite software epub reader is the
https://addons.mozilla.org/en-US/firefox/addon/45281/[Firefox
PUBReader addon].  Browsers are a natural fit for EPUB (EPUB is just a
bunch of zipped HTML files) and I'd like to see browsers support EPUB
natively.

As of writing this article most eBook readers (with the notable
exception of Amazon's Kindle) support the EPUB format.

